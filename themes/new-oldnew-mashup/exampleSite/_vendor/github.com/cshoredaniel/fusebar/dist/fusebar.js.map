{"version":3,"file":"fusebar.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseKeyOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 2,\n  threshold: 0.3,  // default of 0.6 matches too much\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      executeSearch(searchQuery)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery) {\n  var fuse\n  var result\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var haveResult = false\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var searchFuseOptions = fuseKeyOptions\n      searchFuseOptions.keys = [\n        {\n          name: 'tags',\n          weight: 0.99\n        }\n      ]\n      searchFuseOptions.minMatchCharLength = Math.floor(searchQuery.length * 0.8)\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Tags', 0)\n        haveResult = true\n      }\n      searchFuseOptions.keys = [\n        {\n          name: 'categories',\n          weight: 0.99\n        }\n      ]\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Categories', 1)\n        haveResult = true\n      }\n\n      searchFuseOptions.keys = [\n        {\n          name: 'title',\n          weight: 0.6\n        },\n        {\n          name: 'content',\n          weight: 0.4\n        }\n      ]\n      searchFuseOptions.distance = 10000\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery, 2)\n        haveResult = true\n      }\n\n      if (!haveResult) {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n\n  return false\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery, baseResNum) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + (resnum + baseResNum).toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nfunction populateKeyResults(results, searchQuery, key, resnum) { // eslint-disable-line no-unused-vars\n  var lowerKey = key.toString().toLowerCase()\n  var resultElement = document.createElement('div')\n  resultElement.setAttribute('class', 'search-result')\n  resultElement.id = 'search-result-0'\n  var keysElement = document.createElement('div')\n  keysElement.setAttribute('class', 'search-result-' + lowerKey)\n  keysElement.innerHTML = '<b>' + key + '</b>  (follow links for all matching pages): '\n  var matchedKeys = {}\n  var firstVal = true\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n\n    if (typeof resultMap[lowerKey] !== 'undefined') { /* marked */\n      var keyElVal\n      result.matches.forEach(function (match) { // eslint-disable-line no-unused-vars\n        var keyElement = null\n        if (match.value == resultMap[lowerKey].original_value) {\n          if (!matchedKeys[match.value]) {\n            if (!firstVal) {\n              keysElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            matchedKeys[match.value] = true\n            keyElVal = document.createElement('span')\n            keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n            keyElement = document.createElement('a')\n            keyElement.setAttribute('href', '/' + encodeURIComponent(lowerKey) + '/' + encodeURIComponent(match.value) + '/')\n            keyElement.appendChild(keyElVal)\n          }\n        }\n        if (keyElement) {\n          keysElement.appendChild(keyElement)\n        }\n      })\n    }\n  })\n\n  resultElement.appendChild(keysElement)\n\n  document.getElementById('search-results').appendChild(resultElement)\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["summaryInclude","fuseKeyOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","doCloseSearch","document","getElementById","style","innerHTML","doSearch","searchQuery","search_form","s","value","executeSearch","para","createElement","innerText","appendChild","fuse","result","request","XMLHttpRequest","open","indexurl","onload","status","haveResult","jsonprep","responseText","replace","pages","JSON","parse","searchFuseOptions","keys","name","weight","Math","floor","length","Fuse","search","populateKeyResults","populateResults","console","log","onerror","send","createMark","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","baseResNum","resnum","resultElement","id","toString","item","content","resultMap","resultKeys","lowerKey","toLowerCase","keyElement","resultTitleLink","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title","keysElement","matchedKeys","match","encodeURIComponent"],"mappings":"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"}