{"version":3,"file":"fusebar.common.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseKeyOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 2,\n  threshold: 0.3,  // default of 0.6 matches too much\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      executeSearch(searchQuery)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery) {\n  var fuse\n  var result\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var haveResult = false\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var searchFuseOptions = fuseKeyOptions\n      searchFuseOptions.keys = [\n        {\n          name: 'tags',\n          weight: 0.99\n        }\n      ]\n      searchFuseOptions.minMatchCharLength = Math.floor(searchQuery.length * 0.8)\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Tags', 0)\n        haveResult = true\n      }\n      searchFuseOptions.keys = [\n        {\n          name: 'categories',\n          weight: 0.99\n        }\n      ]\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Categories', 1)\n        haveResult = true\n      }\n\n      searchFuseOptions.keys = [\n        {\n          name: 'title',\n          weight: 0.6\n        },\n        {\n          name: 'content',\n          weight: 0.4\n        }\n      ]\n      searchFuseOptions.distance = 10000\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery, 2)\n        haveResult = true\n      }\n\n      if (!haveResult) {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n\n  return false\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery, baseResNum) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + (resnum + baseResNum).toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nfunction populateKeyResults(results, searchQuery, key, resnum) { // eslint-disable-line no-unused-vars\n  var lowerKey = key.toString().toLowerCase()\n  var resultElement = document.createElement('div')\n  resultElement.setAttribute('class', 'search-result')\n  resultElement.id = 'search-result-0'\n  var keysElement = document.createElement('div')\n  keysElement.setAttribute('class', 'search-result-' + lowerKey)\n  keysElement.innerHTML = '<b>' + key + '</b>  (follow links for all matching pages): '\n  var matchedKeys = {}\n  var firstVal = true\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n\n    if (typeof resultMap[lowerKey] !== 'undefined') { /* marked */\n      var keyElVal\n      result.matches.forEach(function (match) { // eslint-disable-line no-unused-vars\n        var keyElement = null\n        if (match.value == resultMap[lowerKey].original_value) {\n          if (!matchedKeys[match.value]) {\n            if (!firstVal) {\n              keysElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            matchedKeys[match.value] = true\n            keyElVal = document.createElement('span')\n            keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n            keyElement = document.createElement('a')\n            keyElement.setAttribute('href', '/' + encodeURIComponent(lowerKey) + '/' + encodeURIComponent(match.value) + '/')\n            keyElement.appendChild(keyElVal)\n          }\n        }\n        if (keyElement) {\n          keysElement.appendChild(keyElement)\n        }\n      })\n    }\n  })\n\n  resultElement.appendChild(keysElement)\n\n  document.getElementById('search-results').appendChild(resultElement)\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["summaryInclude","fuseKeyOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","doCloseSearch","document","getElementById","style","innerHTML","doSearch","searchQuery","search_form","s","value","executeSearch","para","createElement","innerText","appendChild","fuse","result","request","XMLHttpRequest","open","indexurl","onload","status","haveResult","jsonprep","responseText","replace","pages","JSON","parse","searchFuseOptions","keys","name","weight","Math","floor","length","Fuse","search","populateKeyResults","populateResults","console","log","onerror","send","createMark","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","baseResNum","resnum","resultElement","id","toString","item","content","resultMap","resultKeys","lowerKey","toLowerCase","keyElement","resultTitleLink","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title","keysElement","matchedKeys","match","encodeURIComponent"],"mappings":"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"}