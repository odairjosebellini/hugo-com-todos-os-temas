{"version":3,"file":"fusebar.esm.min.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseKeyOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 2,\n  threshold: 0.3,  // default of 0.6 matches too much\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      executeSearch(searchQuery)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery) {\n  var fuse\n  var result\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var haveResult = false\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var searchFuseOptions = fuseKeyOptions\n      searchFuseOptions.keys = [\n        {\n          name: 'tags',\n          weight: 0.99\n        }\n      ]\n      searchFuseOptions.minMatchCharLength = Math.floor(searchQuery.length * 0.8)\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Tags', 0)\n        haveResult = true\n      }\n      searchFuseOptions.keys = [\n        {\n          name: 'categories',\n          weight: 0.99\n        }\n      ]\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Categories', 1)\n        haveResult = true\n      }\n\n      searchFuseOptions.keys = [\n        {\n          name: 'title',\n          weight: 0.6\n        },\n        {\n          name: 'content',\n          weight: 0.4\n        }\n      ]\n      searchFuseOptions.distance = 10000\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery, 2)\n        haveResult = true\n      }\n\n      if (!haveResult) {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n\n  return false\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery, baseResNum) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + (resnum + baseResNum).toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nfunction populateKeyResults(results, searchQuery, key, resnum) { // eslint-disable-line no-unused-vars\n  var lowerKey = key.toString().toLowerCase()\n  var resultElement = document.createElement('div')\n  resultElement.setAttribute('class', 'search-result')\n  resultElement.id = 'search-result-0'\n  var keysElement = document.createElement('div')\n  keysElement.setAttribute('class', 'search-result-' + lowerKey)\n  keysElement.innerHTML = '<b>' + key + '</b>  (follow links for all matching pages): '\n  var matchedKeys = {}\n  var firstVal = true\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n\n    if (typeof resultMap[lowerKey] !== 'undefined') { /* marked */\n      var keyElVal\n      result.matches.forEach(function (match) { // eslint-disable-line no-unused-vars\n        var keyElement = null\n        if (match.value == resultMap[lowerKey].original_value) {\n          if (!matchedKeys[match.value]) {\n            if (!firstVal) {\n              keysElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            matchedKeys[match.value] = true\n            keyElVal = document.createElement('span')\n            keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n            keyElement = document.createElement('a')\n            keyElement.setAttribute('href', '/' + encodeURIComponent(lowerKey) + '/' + encodeURIComponent(match.value) + '/')\n            keyElement.appendChild(keyElVal)\n          }\n        }\n        if (keyElement) {\n          keysElement.appendChild(keyElement)\n        }\n      })\n    }\n  })\n\n  resultElement.appendChild(keysElement)\n\n  document.getElementById('search-results').appendChild(resultElement)\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["fuseKeyOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","doCloseSearch","document","getElementById","style","innerHTML","doSearch","searchQuery","search_form","s","value","executeSearch","para","createElement","innerText","appendChild","fuse","result","request","XMLHttpRequest","open","indexurl","onload","status","haveResult","jsonprep","responseText","replace","pages","JSON","parse","searchFuseOptions","keys","name","weight","Math","floor","length","Fuse","search","populateKeyResults","populateResults","console","log","onerror","send","createMark","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","baseResNum","resnum","resultElement","id","toString","item","content","resultMap","keyElement","resultTitleLink","lowerKey","toLowerCase","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title","keysElement","matchedKeys","match","encodeURIComponent"],"mappings":"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"}