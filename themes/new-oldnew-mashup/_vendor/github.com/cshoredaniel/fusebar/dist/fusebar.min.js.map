{"version":3,"file":"fusebar.min.js","sources":["../src/index.js"],"sourcesContent":["/* global indexurl Fuse */\n\nvar summaryInclude = 1000\nvar fuseKeyOptions = { // See Fuse.js for details\n  distance: 1000,\n  findAllMatches: true,\n  shouldSort: true,\n  includeMatches: true,\n  minMatchCharLength: 2,\n  threshold: 0.3,  // default of 0.6 matches too much\n}\n\nfunction doCloseSearch() { // eslint-disable-line no-unused-vars\n  if (document.getElementById('search-results')) {\n    document.getElementById('search-results').style = 'display: none; visibility: hidden;'\n    document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n  }\n}\n\nfunction doSearch() { // eslint-disable-line no-unused-vars\n  var searchQuery = document.search_form.s.value\n  if (searchQuery) {\n    if (document.getElementById('search-query')) {\n      document.getElementById('search-results').innerHTML = '<h2>Search Results</h2>'\n\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n      executeSearch(searchQuery)\n    }\n  } else {\n    var para = document.createElement('p')\n    para.innerText = 'Please enter a word or phrase above'\n    if (document.getElementById('search-results')) {\n      document.getElementById('search-results').appendChild(para)\n      document.getElementById('search-results').style = 'display: block; visibility: visible;'\n    }\n  }\n  return false\n}\n\nfunction executeSearch(searchQuery) {\n  var fuse\n  var result\n  var request = new XMLHttpRequest()\n  request.open('GET', indexurl, true)\n  request.onload = function () {\n    if (request.status >= 200 && request.status < 400) {\n      var haveResult = false\n      var jsonprep = request.responseText.replace(/$/, ' ')\n      var pages = JSON.parse(jsonprep)\n      var searchFuseOptions = fuseKeyOptions\n      searchFuseOptions.keys = [\n        {\n          name: 'tags',\n          weight: 0.99\n        }\n      ]\n      searchFuseOptions.minMatchCharLength = Math.floor(searchQuery.length * 0.8)\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Tags', 0)\n        haveResult = true\n      }\n      searchFuseOptions.keys = [\n        {\n          name: 'categories',\n          weight: 0.99\n        }\n      ]\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateKeyResults(result, searchQuery, 'Categories', 1)\n        haveResult = true\n      }\n\n      searchFuseOptions.keys = [\n        {\n          name: 'title',\n          weight: 0.6\n        },\n        {\n          name: 'content',\n          weight: 0.4\n        }\n      ]\n      searchFuseOptions.distance = 10000\n\n      fuse = new Fuse(pages, searchFuseOptions)\n      result = fuse.search(searchQuery)\n      if (result.length > 0) {\n        populateResults(result, searchQuery, 2)\n        haveResult = true\n      }\n\n      if (!haveResult) {\n        var para = document.createElement('p')\n        para.innerHTML = 'No matches found'\n        document.getElementById('search-results').appendChild(para)\n      }\n    } else {\n      console.log('fusebar had error ' + request.status + ' on ' + indexurl)\n    }\n  }\n  request.onerror = function () {\n    console.log('fusebar search connection error ' + request.status)\n  }\n  request.send()\n\n  return false\n}\n\nfunction createMark(value) {\n  var markel = document.createElement('mark')\n  var spanel = document.createElement('span')\n  spanel.setAttribute('class', 'mark')\n  spanel.innerHTML = value\n  markel.appendChild(spanel)\n\n  return markel\n}\n\nfunction markMatches(matches) {\n  var newResult = {}\n  matches.forEach(function (items, num) { // eslint-disable-line no-unused-vars\n    var newElement = document.createElement('div')\n\n    var prevIndexEnd = 0\n\n    items.indices.forEach(function (indexpair, indexnum) { // eslint-disable-line no-unused-vars\n      if (items.key == 'content' && items.value.length > summaryInclude) {\n        items.value = items.value.substring(0, summaryInclude)\n      }\n\n      var matchString = items.value.substring(indexpair[0], indexpair[1] + 1)\n      if (indexpair[0] >= prevIndexEnd) {\n        var newSubString = document.createElement('span')\n        newSubString.innerHTML = items.value.substring(prevIndexEnd, indexpair[0])\n        newElement.appendChild(newSubString)\n      }\n\n      newElement.appendChild(createMark(matchString))\n\n      prevIndexEnd = indexpair[1] + 1\n    })\n\n    if ((prevIndexEnd) < items.value.length) {\n      newElement.appendChild(\n        document.createTextNode(\n          items.value.substring(prevIndexEnd, items.value.length)\n        )\n      )\n    }\n\n    newResult[items.key] = {\n      'element': newElement,\n      'original_value': items.value\n    }\n  })\n\n  return newResult\n}\n\nfunction populateResults(results, searchQuery, baseResNum) { // eslint-disable-line no-unused-vars\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    var resultElement = document.createElement('div')\n    resultElement.setAttribute('class', 'search-result')\n    resultElement.id = 'search-result-' + (resnum + baseResNum).toString()\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n    var resultKeys = ['Title', 'Content']\n    resultKeys.forEach(function (key) {\n\n      var lowerKey = key.toString().toLowerCase()\n      var keyElement\n      var resultTitleLink\n\n      if (lowerKey == 'title') {\n        keyElement = document.createElement('h4')\n        keyElement.setAttribute('class', 'search-result-title')\n        resultTitleLink = document.createElement('a')\n        resultTitleLink.setAttribute('href', result.item.permalink)\n      }\n\n      if (typeof resultMap[lowerKey] !== 'undefined') {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = resultMap[lowerKey].element.innerHTML\n          if (!resultMap[lowerKey].element.innerHTML || resultMap[lowerKey].element.innerHTML == '') {\n            resultTitleLink.innnerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          keyElement = resultMap.content.element\n          keyElement.setAttribute('class', 'search-result-content')\n        } else {\n          var keyElVal\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          var firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            if (tcval == resultMap[lowerKey].original_value) {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n\n            } else {\n              keyElVal = document.createElement('span')\n              keyElVal.innerHTML = tcval\n            }\n\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      } else {\n        if (lowerKey == 'title') {\n          resultTitleLink.innerHTML = result.item.title\n          if (!result.item.title || result.item.title == '') {\n            resultTitleLink.innerHTML = 'Untitled'\n          }\n        } else if (lowerKey == 'content') {\n          if (result.item.content && (result.item.content != '')) {\n            keyElement = document.createElement('div')\n            keyElement.innerHTML = result.item.content\n          }\n        } else if (result.item[lowerKey]) {\n          keyElement = document.createElement('div')\n          keyElement.setAttribute('class', 'search-result-' + lowerKey)\n          keyElement.appendChild(document.createTextNode(key + ':  '))\n          firstVal = true\n          result.item[lowerKey].forEach(function (tcval, tckey) { // eslint-disable-line no-unused-vars\n            if (!firstVal) {\n              keyElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            var keyElVal = document.createElement('span')\n            keyElVal.innerHTML = tcval\n            keyElement.appendChild(keyElVal)\n          })\n        }\n      }\n\n      if (lowerKey == 'title') {\n        keyElement.appendChild(resultTitleLink)\n      }\n\n      if (typeof keyElement !== 'undefined') {\n        resultElement.appendChild(keyElement)\n      }\n    })\n\n    document.getElementById('search-results').appendChild(resultElement)\n  })\n\n  return true\n}\n\nfunction populateKeyResults(results, searchQuery, key, resnum) { // eslint-disable-line no-unused-vars\n  var lowerKey = key.toString().toLowerCase()\n  var resultElement = document.createElement('div')\n  resultElement.setAttribute('class', 'search-result')\n  resultElement.id = 'search-result-0'\n  var keysElement = document.createElement('div')\n  keysElement.setAttribute('class', 'search-result-' + lowerKey)\n  keysElement.innerHTML = '<b>' + key + '</b>  (follow links for all matching pages): '\n  var matchedKeys = {}\n  var firstVal = true\n  results.forEach(function (result, resnum) { // eslint-disable-line no-unused-vars\n    if (result.item.content && result.item.content.length > summaryInclude) {\n      result.item.content = result.item.content.substring(0, summaryInclude)\n    }\n    var resultMap = markMatches(result.matches)\n\n    if (typeof resultMap[lowerKey] !== 'undefined') { /* marked */\n      var keyElVal\n      result.matches.forEach(function (match) { // eslint-disable-line no-unused-vars\n        var keyElement = null\n        if (match.value == resultMap[lowerKey].original_value) {\n          if (!matchedKeys[match.value]) {\n            if (!firstVal) {\n              keysElement.appendChild(document.createTextNode(', '))\n            } else {\n              firstVal = false\n            }\n            matchedKeys[match.value] = true\n            keyElVal = document.createElement('span')\n            keyElVal.innerHTML = resultMap[lowerKey].element.innerHTML\n            keyElement = document.createElement('a')\n            keyElement.setAttribute('href', '/' + encodeURIComponent(lowerKey) + '/' + encodeURIComponent(match.value) + '/')\n            keyElement.appendChild(keyElVal)\n          }\n        }\n        if (keyElement) {\n          keysElement.appendChild(keyElement)\n        }\n      })\n    }\n  })\n\n  resultElement.appendChild(keysElement)\n\n  document.getElementById('search-results').appendChild(resultElement)\n  return true\n}\n\nexport {\n  doCloseSearch,\n  doSearch,\n  executeSearch,\n  createMark,\n  markMatches,\n  populateResults\n}\n"],"names":["fuseKeyOptions","distance","findAllMatches","shouldSort","includeMatches","minMatchCharLength","threshold","executeSearch","searchQuery","fuse","result","request","XMLHttpRequest","open","indexurl","onload","status","haveResult","jsonprep","responseText","replace","pages","JSON","parse","searchFuseOptions","keys","name","weight","Math","floor","length","Fuse","search","populateKeyResults","populateResults","para","document","createElement","innerHTML","getElementById","appendChild","console","log","onerror","send","createMark","value","markel","spanel","setAttribute","markMatches","matches","newResult","forEach","items","num","newElement","prevIndexEnd","indices","indexpair","indexnum","key","substring","matchString","newSubString","createTextNode","results","baseResNum","resnum","resultElement","id","toString","item","content","resultMap","keyElement","resultTitleLink","lowerKey","toLowerCase","permalink","element","innnerHTML","keyElVal","firstVal","tcval","tckey","original_value","title","keysElement","matchedKeys","match","encodeURIComponent","style","search_form","s","innerText"],"mappings":"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"}